<!--+
    |
    |           +=======================================================================+
    |           |  Sesame2 Ontology Manager for Semantic Turkey OSGi bundle build		|
    |           +=======================================================================+
    |
    +-->

<project default="final" basedir="." name="ST_EXT-R_Sesame2ImplExtension" xmlns:artifact="antlib:org.apache.maven.artifact.ant">

	<path id="maven-ant-tasks.classpath" path="./../SemanticTurkeyBM/antlib/maven-ant-tasks-2.0.10.jar" />
	<typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="antlib:org.apache.maven.artifact.ant" classpathref="maven-ant-tasks.classpath" />


	<target name="start" depends="init">

		<echo>======================================================================
               ${fullname} ${version} [${year}]
======================================================================
Building with ${ant.version}
----------------------------------------------------------------------
Using build file ${ant.file}
----------------------------------------------------------------------
Running on Java version ${ant.java.version} on ${os.name}
----------------------------------------------------------------------
Compiler options:
 - debug ......... [${compiler.debug}]
 - optimize ...... [${compiler.optimize}]
 - deprecation ... [${compiler.deprecation}]
======================================================================
</echo>
	</target>

	<target name="init">
		<!-- Set the timestamps -->
		<tstamp />

		<property environment="env" />

		<!-- Get the build properties from an external file -->
		<property file="build.properties" />

		<!-- Set classpath -->
		<path id="classpath">
			<fileset dir="${lib}">
				<include name="*.jar" />
			</fileset>
			<path location="${build}" />
		</path>
	</target>

	<!-- === Preparation ============================================= -->

	<target name="prepare" depends="init">
		<mkdir dir="${dist}/${lib}" />
	</target>


	<!-- === Build Library Dir from Maven Dependencies ============================================= -->

	<target name="buildlib" depends="prepare">
		<artifact:pom id="stpom" file="pom.xml" />
		<artifact:dependencies filesetId="dependency.fileset" pomRefId="stpom" useScope="runtime" />
		<copy todir="${dist}/${lib}">
			<fileset refid="dependency.fileset" />
			<!--
    	  <mapper classpathref="maven-ant-tasks.classpath"
    	          classname="org.apache.maven.artifact.ant.VersionMapper"
    	          from="${stdeps}" to="flatten" />
    	      -->
			<mapper type="flatten" />
		</copy>
	</target>

	<!-- === Compile Java Code ================================================= -->

	<target name="bundle" depends="buildlib">
		<mkdir dir="${build}" />
		<javac sourcepath="" srcdir="${src}" destdir="${build}" debug="${compiler.debug}" optimize="${compiler.optimize}" deprecation="${compiler.deprecation}" target="1.5" source="1.5" nowarn="${compiler.nowarn}" compiler="${compiler}" classpathref="classpath">

			<include name="**/*.java" />
		</javac>
		<jar destfile="target/${stpom.groupId}-${stpom.artifactId}-${stpom.version}.jar" manifest="manifest.mf">
			<fileset dir="${build}" />
			<fileset dir="${dist}" />
		</jar>
	</target>

	<!-- === Delete the distribution folder ================================================= -->

	<target name="delete_dist" depends="bundle" description="deletes the dist folder">
		<delete dir="${dist}" />
	</target>

	<!-- === Final Empty Task ================================================= -->

	<target name="final" depends="delete_dist" />

</project>
