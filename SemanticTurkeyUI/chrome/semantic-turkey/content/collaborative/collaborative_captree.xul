<?xml version="1.0"?>
<?xml-stylesheet href="chrome://global/skin/" type="text/css"?>
<?xml-stylesheet href="captree.css" type="text/css"?>
<!--  /*
  * The contents of this file are subject to the Mozilla Public License
  * Version 1.1 (the "License");  you may not use this file except in compliance
  * with the License.  You may obtain a copy of the License at
  * http://www.mozilla.org/MPL/
  *
  * Software distributed under the License is distributed on an "AS IS" basis,
  * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for
  * the specific language governing rights and limitations under the License.
  *
  * The Original Code is SemanticTurkey.
  *
  * The Initial Developer of the Original Code is University of Roma Tor Vergata.
  * Portions created by University of Roma Tor Vergata are Copyright (C) 2007.
  * All Rights Reserved.
  *
  * SemanticTurkey was developed by the Artificial Intelligence Research Group
  * (art.uniroma2.it) at the University of Roma Tor Vergata (ART)
  * Current information about SemanticTurkey can be obtained at 
  * http://semanticturkey.uniroma2.it
  *
  */ -->
<!-- Daniele Bagni, Marco Cappella (2009): Pannello dell'ontology panel dove viene visualizzato l'albero delle classi e la lista delle istanze in versione collaborativa -->
<window title="Semantic Turkey"
   id="captree-main-window"
   xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
   flex="1"
   width="600"
   height="600">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />    
<script src="chrome://global/content/nsDragAndDrop.js"/>
<script src="chrome://global/content/nsTransferable.js"/> 

<script type="application/x-javascript" src="chrome://semantic-turkey/content/scripts/classDragDrop.js"/>
<script type="application/x-javascript" src="chrome://semantic-turkey/content/http/http.js"/> 
<script type="application/x-javascript" src="chrome://semantic-turkey/content/scripts/ontologySearch.js"/>
<script type="application/x-javascript" src="chrome://semantic-turkey/content/scripts/repository.js"/>
<script type="application/x-javascript" src="chrome://semantic-turkey/content/scripts/instanceEvents.js" />
<script type="application/x-javascript" src="chrome://semantic-turkey/content/scripts/initialize.js"/>
<script type="application/x-javascript" src="chrome://semantic-turkey/content/scripts/highlighting.js"/>
<script type="application/x-javascript" src="chrome://semantic-turkey/content/scripts/Thread.js"/>
<script type="application/x-javascript" src="chrome://semantic-turkey/content/scripts/selectServer.js"/>
<script type="application/x-javascript" src="chrome://semantic-turkey/content/scripts/daemonThread.js"/>
<script type="application/x-javascript" src="chrome://semantic-turkey/content/scripts/userType.js"/>
<script type="application/x-javascript" src="chrome://semantic-turkey/content/scripts/ontName.js"/>
<script type="application/x-javascript" src="chrome://semantic-turkey/content/scripts/userProperties.js"/>
<script type="application/x-javascript">	
	<![CDATA[
	
		var swap = readSwap();
		var request="";
		if(swap=="1"){
			//Daniele Bagni, Marco Cappella (2009):Vengono inviati al server gli hash degli utenti dei quali si ï¿½ interessati a visualizzarne le risorse
			var server=readServer();
			var userType = readUserType();

			var result = readProp();
			request="http://"+server+":1979/semantic_turkey/resources/stserver/STServer?service=cls&type=clsTree";
			var tt=0;
			var ts=0;
			var userHashValue=readUserHash();
			var foundUser=false;
			var newUsers = new Array();
			var newHash = new Array();
			var newColors = new Array();
			for(tt = 0;tt<result.hash.length;tt++){
				if(result.colors[tt]!="No"){
					request= request+"&hash_"+(tt-ts)+"="+result.hash[tt];
				
				}
				else ts++;
				if(result.hash[tt]==userHashValue){
					foundUser=true;
				}
				newUsers[tt]= result.users[tt];
				newHash[tt]=result.hash[tt];
				newColors[tt]=result.colors[tt];
			}
			if(!foundUser){
				request= request+"&hash_"+(tt-ts)+"="+userHashValue;
				newUsers[tt]= readUserName();
				newHash[tt]=userHashValue;
				newColors[tt]=9;
				writeProp(newUsers,newHash,newColors);
			}
			art_semanticturkey.HttpMgr.GETP(request);
		}	
		function getthetree() {
			return document.getElementById('outlineTree');
		}
		function gettherequest() {
			return request;
		}
		
		//Daniele Bagni, Marco Cappella (2009): viene aperta la finestra che mostra le modifiche effettuate all'ontologia giorno per giorno ed alla chiusura di tale finestra refresh dell'albero
		function refreshTree(img){
			
			window.openDialog('chrome://semantic-turkey/content/LoggingMod.xul','_blank','modal=yes,resizable,centerscreen', null); 
			art_semanticturkey.HttpMgr.GETP("http://"+server+":1979/semantic_turkey/resources/stserver/STServer?service=refresh&update=refresh");
			var tree = getthetree();
			var treeChildren = tree.getElementsByTagName('treechildren')[0];
			treeItemsNodes=treeChildren.getElementsByTagName("treeitem");	
			while(treeChildren.hasChildNodes()){
				treeChildren.removeChild(treeChildren.lastChild);
			}
			if(server=="127.0.0.1")
				art_semanticturkey.HttpMgr.GETP("http://"+server+":1979/semantic_turkey/resources/stserver/STServer?service=cls");
			else
				art_semanticturkey.HttpMgr.GETP(request);
			img.image = "images/PNG-Refresh1.png";
		}
		
		//Daniele Bagni, Marco Cappella (2009):  funzione per l'aggiunta di una classe alla propria ontologia oppure al core dell'ontologia
		function freezecls(){
			getthetree().freezeClass('outlineTree',server,'class');
			var img = document.getElementById('refresh');
			art_semanticturkey.HttpMgr.GETP("http://"+server+":1979/semantic_turkey/resources/stserver/STServer?service=refresh&update=refresh");
			var tree = getthetree();
			var treeChildren = tree.getElementsByTagName('treechildren')[0];
			treeItemsNodes=treeChildren.getElementsByTagName("treeitem");	
			while(treeChildren.hasChildNodes()){
				treeChildren.removeChild(treeChildren.lastChild);
			}
			if(server=="127.0.0.1")
				art_semanticturkey.HttpMgr.GETP("http://"+server+":1979/semantic_turkey/resources/stserver/STServer?service=cls");
			else
				art_semanticturkey.HttpMgr.GETP(request);
			img.image = "images/PNG-Refresh1.png";
		}
		
		function gettheList() {
			return document.getElementById('InstancesList');
		}
		
		 function getCallPanel(){
			return "class";
		}
			
		function CreateRootClass(){
			var tree = getthetree();	    
			var isRootNode = "true";
			var parameters = new Object();
			parameters.iconicName =  "";		
			parameters.tree = tree;		
			parameters.parentTreecell= null;
			parameters.isRootNode=isRootNode;
			parameters.type="siblingClass";
			parameters.server=server;
			window.openDialog("chrome://semantic-turkey/content/createClass.xul","_blank","modal=yes,resizable,centerscreen", parameters);
		}
	
	]]>
</script>

<hbox flex="1" > 
<vbox flex="1" orient="vertical">
<grid flex="0">
  <columns>
    <column flex="0"/>
  </columns>
  <rows>
    <row> 
     <toolbox>
     	<!-- Daniele Bagni, Marco Cappella (2009): aggiunto polls management,refresh,legend e freeze -->
	    <toolbar id="findfiles-toolbar">
	     	<toolbarbutton id="createRoot" image="images/class_create.png" onclick="CreateRootClass();" tooltiptext="Create Class"/>
		 	<toolbarbutton id="createSubClass"  image="images/class_addSubClass.png" onclick="getthetree().CreateClass('outlineTree',server);" tooltiptext="Create SubClass"></toolbarbutton>
			<toolbarbutton  id="createSiblingClass"  image="images/class_addSibling.png" onclick="getthetree().CreateSiblingClass('outlineTree',server);" tooltiptext="Create Sibling Class"></toolbarbutton>
			<toolbarbutton  id="removeClass"  image="images/class_delete.png" onclick="getthetree().Delete('outlineTree',server);" tooltiptext="Delete Class"></toolbarbutton>
			<toolbarbutton  id="pollsManagement"  image="images/istogramma.png" onclick="getthetree().pollsManagement(server);" tooltiptext="Polls"></toolbarbutton>
			<toolbarbutton  id="refresh"  image="images/PNG-Refresh1.png" onclick="refreshTree(this);" tooltiptext="Refresh"></toolbarbutton>
			<toolbarbutton  id="Legend"  image="images/legend.png" onclick="window.openDialog('chrome://semantic-turkey/content/legend.xul','_blank','modal=yes,alwaysRaised=yes,resizable,centerscreen', null);" tooltiptext="Legend"></toolbarbutton>
			<!--<toolbarbutton  id="Freeze"  image="images/snow.png" onclick="freezecls();" tooltiptext="Freeze"></toolbarbutton>-->
		</toolbar>
	</toolbox>
</row>
 </rows>
</grid>
<popupset>
	<popup id="clipmenu" onpopuping="getthetree().showHideItems();" align="start">
		<!--<menuitem label="Move Up" oncommand="getthetree().Move('outlineTree', 'up', event);"/>-->
		<!-- <menuitem label="Move Down" oncommand="getthetree().Move('outlineTree', 'down', event);"/>-->
		<!--<menuitem label="Add new rootnode" oncommand="getthetree().topcategory('thetreechildren', prompt('Please enter a nodename','undefined'));"/>
		<menuitem label="Add node" oncommand="getthetree().CreateSubTree('outlineTree', '');"/> -->
		 <!--<menuitem label="Delete" oncommand="getthetree().DeleteCurrent('outlineTree');"/> -->
		<menuitem id="popupCreateInstance" oncommand="getthetree().createInstance('outlineTree',server);" flex="1">
			<menuitem-iconic flex="1">
				<image src="images/individual_add.png" flex="0"/>
				<label value="Create Instance" flex="0"/> 						
			</menuitem-iconic>
		</menuitem>
		<!--<menuitem oncommand="getthetree().PartialSemanticNavigation(server);" flex="1">
			<menuitem-iconic flex="1">
				<image src="images/ontology20.png" flex="0"/>
				<label value="SemanticNavigation" flex="0"/> 						
			</menuitem-iconic>
		</menuitem>-->
		<menuitem id="popupCreateClass" oncommand="getthetree().CreateClass('outlineTree',server);" flex="1">
			<menuitem-iconic flex="1">
				<image src="images/class_addSubClass.png" flex="0"/>
				<label value="Add SubClass" flex="0"/> 						
			</menuitem-iconic>
		</menuitem>
		<menuitem id="popupRemoveItem" oncommand="getthetree().Delete('outlineTree',server);" flex="1">
					<menuitem-iconic id="removeItemIc" flex="1">
								<image src="images/class_delete.png" flex="0"/>
								<label value="Delete" flex="0"/> 						
					</menuitem-iconic>	
		</menuitem>
		<menuitem  id="popupModifyName" oncommand="getthetree().ModifyName('outlineTree',server);" flex="1">
		<menuitem-iconic>
				<image src="images/empty20x20.png" flex="0"/> 
				<label value="Modify name"/> 						
			</menuitem-iconic>
		</menuitem>
		<menuitem  id="popupAddSynonym" oncommand="getthetree().AddSynonym('outlineTree',server);" flex="1">
		<menuitem-iconic flex="1">
				 <image src="images/empty20x20.png" flex="0"/> 
				<label value="Add Synonym" flex="0"/> 						
			</menuitem-iconic>
		</menuitem>
		<menuitem id="popupCreateSibling" oncommand="getthetree().CreateSiblingClass('outlineTree',server);" flex="1">
			<menuitem-iconic >
				<image src="images/class_addSibling.png" flex="0"/>
				<label value="Create Sibling Class" flex="0"/> 						
			</menuitem-iconic>
		</menuitem>
		<menuitem id="popupViewContexts" oncommand="getthetree().viewContexts('outlineTree',server);" flex="1">
			<menuitem-iconic flex="1">
				<image src="images/empty20x20.png" flex="0"/>
				<label value="View Contexts" flex="0"/> 						
			</menuitem-iconic>
		</menuitem>
		<menuitem oncommand="getthetree().commentsManagement('outlineTree',server,'[Class]');" flex="1">
			<menuitem-iconic >
				<image src="images/comment.png"/>
				<label value="Comments"/> 						
			</menuitem-iconic>	
		</menuitem>
		<menuitem oncommand="getthetree().standardPolls('outlineTree',server,'[Class]');" flex="1">
			<menuitem-iconic >
				<image src="images/istogramma.png"/>
				<label value="Vote"/> 						
			</menuitem-iconic>	
		</menuitem>
		<!--<menuitem id="popupFreeze" oncommand="freezecls();" flex="1">
			<menuitem-iconic >
				<image src="images/snow.png"/>
				<label value="Freeze"/> 						
			</menuitem-iconic>	
		</menuitem>-->
		<!-- <menuitem label="Rename" oncommand="getthetree().RenameCurrent('outlineTree','category');"/> -->
	</popup>
	
</popupset>

<tree hidecolumnpicker="true" id="outlineTree" flex="1" context="clipmenu" 
 ondraggesture="treeDragGesture(event)" ondragenter="treeDragEnter(event)" 
 ondragover="return DragOverContentArea(event);" ondragexit="treeDragExit(event)" ondragdrop="treeDragDrop(event,server);">
  <treecols>
    <treecol id="category"  label= "Classes" primary="true" flex="1">
    	<!-- <treecol-image primary="true">
    		<image src= "images/class.png" primary="true"/>
    		<label value="Classes" primary="true"/>
    	</treecol-image> -->
    </treecol>
  </treecols>
  <treechildren id="22">
 </treechildren>
</tree>
			
	<!-- NScarpato 17/11/2006 Panel for instance view -->
			<splitter  state="open" collapse="after"
				resizebefore="closest"
				resizeafter="farthest">
			</splitter>
	<!--	 <hbox flex="1">
				<vbox flex="1">-->
			
			<popupset>
				<popup id="clipmenulist" onpopupshowing="showHideItemsList();">
					<!--<menuitem oncommand="getthetree().WebLinks('InstancesList',server);">
					
					<menuitem-iconic >
						<image src="images/world20.png" />
						<label value="WebLinks" /> 						
					</menuitem-iconic>
					</menuitem>
					<menuitem oncommand="getthetree().PartialSemanticNavigation(server);">
					<menuitem-iconic >
						<image src="images/ontology20.png"/>
						<label value="SemanticNavigation"/> 						
					</menuitem-iconic>		 
					</menuitem>-->
					<menuitem id="popupViewContextsInst" oncommand="getthetree().viewContextsInst(server);" flex="1">
						<menuitem-iconic flex="1">
							<image src="images/empty20x20.png" flex="0"/>
							<label value="View Contexts" flex="0"/> 						
						</menuitem-iconic>
					</menuitem>
					<menuitem id="popupDeleteInst" oncommand="getthetree().DeleteInstance(server);">
					<menuitem-iconic >
								<image src="images/individual_delete.png"/>
								<label value="Delete"/> 						
					</menuitem-iconic>	
					</menuitem>
					<menuitem oncommand="getthetree().commentsManagementInstance('outlineTree',server,'[Instance]');" flex="1">
						<menuitem-iconic >
							<image src="images/comment.png"/>
							<label value="Comments"/> 						
						</menuitem-iconic>	
					</menuitem>
					<menuitem oncommand="getthetree().standardPollsInstance(server,'[Instance]');" flex="1">
						<menuitem-iconic >
							<image src="images/istogramma.png"/>
							<label value="Vote"/> 						
						</menuitem-iconic>	
					</menuitem>
					<!--<menuitem id="popupInstFreeze" oncommand="getthetree().freezeInstance('outlineTree',server,'instance');" flex="1">
						<menuitem-iconic >
							<image src="images/snow.png"/>
							<label value="Freeze"/> 						
					</menuitem-iconic>	
					</menuitem>-->
					<!-- <menuitem id="deepDeleteInst" oncommand="getthetree().DeepDeleteInstance(server);">
					<menuitem-iconic >
								<image src="images/instance.remove.gif"/>
								<label value="Deep Delete"/> 						
					</menuitem-iconic>	
					</menuitem> -->
				</popup>
			</popupset>
								 
					 <listbox id="InstancesList"
					context="clipmenulist" ondraggesture="listDragGesture(event)"
					ondragenter="listDragEnter(event)"
					ondragover="return listDragOverContentArea(event);"
					ondragexit="listDragExit(event)"
					ondragdrop="listDragDrop(event,server);"
					ondblclick="listdblclick(event);">
					
					<listhead>
						<listheader>
							<listitem-iconic>
								<!-- <image src= "images/individual.png"/> -->
								<label value="Instances"/>
							</listitem-iconic>
						</listheader>		
					</listhead>
							
					</listbox> 	
									
				</vbox>
				
			</hbox>
	<splitter orient ="vertical" state="open" collapse="after"
				resizeafter="closest"
				resizebefore="closest">
				</splitter>
	<hbox flex="0">
	<vbox flex="0">
	<textbox value="Enter query..." id="ontosearch"
				onfocus="this.style.color='blue'; this.value='';"
				onblur="this.style.color='black'; this.value='Search element...';"
				onkeypress="if(event.keyCode == 13){OntologySearch.search(this.value,server)}" />
				</vbox>
			</hbox>
<script type="application/x-javascript">	
	<![CDATA[
	
		//Daniele Bagni, Marco Cappella (2009): Se utente semplice disattivate tutte le opzioni per la modifica dell'onotologia
		var userType = readUserType();
		if(userType=="Simple User"){
			document.getElementById("createRoot").hidden=true;
		//	document.getElementById("Freeze").hidden=true;
			document.getElementById("createSubClass").hidden=true;
			document.getElementById("createSiblingClass").hidden=true;
			document.getElementById("removeClass").hidden=true;
			document.getElementById("popupCreateInstance").disabled=true;
			document.getElementById("popupCreateClass").disabled=true;
			document.getElementById("popupRemoveItem").disabled=true;
			document.getElementById("popupModifyName").disabled=true;
			document.getElementById("popupAddSynonym").disabled=true;
			document.getElementById("popupCreateSibling").disabled=true;
			document.getElementById("popupDeleteInst").disabled=true;
		//	document.getElementById("popupFreeze").disabled=true;
		//	document.getElementById("popupInstFreeze").disabled=true;
		}
		
	]]>
</script>
</window>

